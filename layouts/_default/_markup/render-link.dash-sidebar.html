{{- $href := (.Destination | safeURL) -}}
{{- $text := (.Text | safeHTML) -}}
{{- if and (strings.HasPrefix $href "http") (not (in $href "developers.cloudflare.com")) -}}
  {{- partial "external.link" (dict "url" $href "text" $text) -}}
{{- else if and (or (strings.HasPrefix $href "/api/") (in $href "developers.cloudflare.com/api/")) (ne $.Page.RelPermalink "/") -}}
  {{- partial "api.link" (dict "url" $href "text" $text) -}}
{{- else -}}
  {{- $internal := urls.Parse $href -}}
  {{- $linkedPage := .Page.Site.GetPage $internal.Path -}}
  {{- if not (eq $linkedPage nil) -}}
    {{- $linkedPage = .Page.Site.GetPage (replaceRE `/$` "" $internal.Path) -}}
  {{- end -}}
  {{- $linkedPageDashSidebar := $linkedPage.OutputFormats.Get "dash-sidebar" -}}
  {{- if ($linkedPageDashSidebar) -}}
    <a href={{ $linkedPageDashSidebar.RelPermalink }} class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">{{- $text -}}</span></a>
  {{- else -}}
    {{- partial "external.link" (dict "url" $href "text" $text) -}}
  {{- end -}}
{{- end -}}